const express = require("express"); const path = require("path"); const moment = require("moment"); const app = express(); const PORT = 3000; app.use(express.json()); app.use(express.static("public")); const merchants = new Map(); app.get("/", (req, res) => { res.redirect("/dashboard.html"); }); app.get("/dashboard", (req, res) => { res.redirect("/dashboard.html"); }); app.post("/api/onboarding/start", (req, res) => { const { whatsappNumber, goLiveDate, businessName } = req.body; if (!whatsappNumber || !goLiveDate) { return res.status(400).json({ error: "WhatsApp number and go-live date are required" }); } const goLive = moment(goLiveDate, "DD/MM/YYYY"); const today = moment(); const daysUntilGoLive = goLive.diff(today, "days"); const canMeetSLA = daysUntilGoLive >= 5; const merchantId = "merchant-" + Date.now(); const merchant = { merchantId, whatsappNumber, businessName, goLiveDate: goLive.toDate(), slaStatus: canMeetSLA ? "within_sla" : "at_risk", currentStep: "welcome", status: canMeetSLA ? "initiated" : "escalated", createdAt: new Date() }; merchants.set(merchantId, merchant); res.json({ success: true, merchantId, canMeetSLA, daysUntilGoLive, status: merchant.status, message: canMeetSLA ? `✅ Great! We can meet your Go-Live date of ${goLiveDate}. You have ${daysUntilGoLive} days.` : `⚠️ Tight timeline! Only ${daysUntilGoLive} days until Go-Live. Escalating to specialist team.` }); }); app.get("/api/admin/dashboard", (req, res) => { const totalMerchants = merchants.size; const escalatedMerchants = Array.from(merchants.values()).filter(m => m.status === "escalated").length; const atRiskMerchants = Array.from(merchants.values()).filter(m => m.slaStatus === "at_risk").length; res.json({ totalMerchants, escalatedMerchants, atRiskMerchants, completionRate: 0 }); }); app.get("/api/admin/merchants", (req, res) => { res.json({ merchants: Array.from(merchants.values()) }); }); app.listen(PORT, () => { console.log(`🚀 WhatsApp Onboarding Assistant running on port ${PORT}`); console.log(`📊 Dashboard: http://localhost:${PORT}/dashboard.html`); console.log(`🔗 API: http://localhost:${PORT}/api`); });
